(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[949],{4111:(e,t,r)=>{"use strict";r.d(t,{sV:()=>h,z1:()=>o,QO:()=>m});class a extends Error{constructor(e){super(e),this.code="WALLET_ERROR",this.name="WalletError"}}class s extends a{constructor(e="Wallet storage operation failed."){super(e),this.code="STORAGE_ERROR",this.name="StorageError"}}class n extends a{constructor(e="Failed to restore wallet"){super(e),this.code="WALLET_RESTORE_ERROR",this.name="WalletRestoreError"}}var l=r(6818).Buffer,o=function(e){return e.Mainnet="mainnet",e.Testnet="testnet",e}({}),i=function(e){return e[e.Normal=128]="Normal",e[e.High=256]="High",e}({});class c{static create(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:128,r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mainnet",s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"My Wallet",n=e.HDWallet.create(t,"");return new c(e,n,r,a,s)}static restore(e,t,r){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mainnet",s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"My Wallet";try{let n=e.HDWallet.createWithMnemonic(t,"");return new c(e,n,r,a,s)}catch(e){throw new n("Failed to restore wallet: ".concat(e instanceof Error?e.message:"Unknown error"))}}getAddresses(){return[...this.addresses]}getWalletInfo(){return{mnemonicWordCount:this.getMnemonicWordCount(),addressCount:this.addresses.length,createdAt:this.createdAt,network:this.network,name:this.name}}createAddress(e){let t="m/44'/21888'/3'/".concat(this.nextEd25519Index,"'"),r=this.wallet.getKey(this.core.CoinType.pactus,t),a=this.core.CoinTypeExt.deriveAddress(this.core.CoinType.pactus,r),s=r.getPublicKeyCurve25519(),n=l.from(s.data()).toString("hex");return this.addresses.push({path:t,address:a,label:e||"Address ".concat(this.nextEd25519Index+1),publicKey:n}),this.nextEd25519Index++,a}getMnemonic(){return this.wallet.mnemonic()}getMnemonicWordCount(){return this.wallet.mnemonic().trim().split(/\s+/).length}getNetworkType(){return this.network}isTestnet(){return"testnet"===this.network}getName(){return this.name}setName(e){this.name=e}export(){return{version:"3.0",uuid:crypto.randomUUID?crypto.randomUUID():this.generateUUID(),creation_time:this.createdAt.getTime(),mnemonic:this.getMnemonic(),addresses:this.addresses,nextEd25519Index:this.nextEd25519Index,network:this.network,name:this.name,keystore:this.keystore}}generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}import(e){this.nextEd25519Index=e.nextEd25519Index,this.addresses=[],e.addresses&&e.addresses.length>0&&(this.addresses=e.addresses.map(e=>({...e,path:e.path||"",address:e.address||"",label:e.label||"",publicKey:e.publicKey||""}))),e.network&&(this.network=e.network),e.name&&(this.name=e.name)}constructor(e,t,r,a="mainnet",s="My Wallet"){this.addresses=[],this.core=e,this.wallet=t,this.nextEd25519Index=0,this.addresses=[],this.createdAt=new Date,this.network=a,this.name=s,this.keystore=""}}class h{constructor(){this.get=async e=>{let t=localStorage.getItem(e);return t?JSON.parse(t):null},this.set=async(e,t)=>(localStorage.setItem(e,JSON.stringify(t)),t),this.setBatch=async e=>(Object.entries(e).forEach(e=>{let[t,r]=e;localStorage.setItem(t,JSON.stringify(r))}),e),this.delete=async e=>{let t=await this.get(e);return null!=t&&localStorage.removeItem(e),t},this.clear=async()=>{localStorage.clear()}}}class u{async createWallet(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.Normal,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.Mainnet,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"My Wallet";return this.currentWallet=c.create(this.core,t,e,r,a),await this.saveWallet(e),this.currentWallet}async restoreWallet(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.Mainnet,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"My Wallet";return this.currentWallet=c.restore(this.core,e,t,r,a),await this.saveWallet(t),this.currentWallet}async loadWallet(e){if(!this.storage)return null;try{let t=await this.storage.get(this.walletStorageKey);if(!t)return null;let r=JSON.parse(t);if(!r.mnemonic)throw new s("Wallet data does not contain mnemonic");return this.currentWallet=c.restore(this.core,r.mnemonic,e,r.network,r.name),this.currentWallet.import(r),this.currentWallet}catch(e){throw new s("Failed to load wallet: ".concat(e instanceof Error?e.message:"Unknown error"))}}async saveWallet(e){if(!this.currentWallet)return null;if(!this.storage)return this.currentWallet.export();try{let e=this.currentWallet.export(),t=JSON.stringify(e);return await this.storage.set(this.walletStorageKey,t),e}catch(e){throw new s("Failed to save wallet: ".concat(e instanceof Error?e.message:"Unknown error"))}}async deleteWallet(){if(!this.storage)return this.currentWallet=void 0,!0;try{return await this.storage.delete(this.walletStorageKey),this.currentWallet=void 0,!0}catch(e){throw new s("Failed to delete wallet: ".concat(e instanceof Error?e.message:"Unknown error"))}}getCurrentWallet(){return this.currentWallet}async hasWallet(){return!!this.storage&&null!==await this.storage.get(this.walletStorageKey)}constructor(e,t){this.walletStorageKey="pactus_wallet_data",this.core=e,this.storage=t}}var d=r(933);class w{constructor(){this.storage={},this.get=async e=>{var t;return null!==(t=this.storage[e])&&void 0!==t?t:null},this.set=async(e,t)=>(this.storage[e]=t,t),this.setBatch=async e=>(Object.assign(this.storage,e),e),this.delete=async e=>{let t=await this.get(e);return null!=t&&delete this.storage[e],t},this.clear=async()=>{this.storage={}}}}let g={storage:new w};async function m(e){try{let t=await (0,d.zW)();return new u(t,e)}catch(e){throw console.error("Failed to initialize wallet SDK with custom storage:",e),e}}},5178:(e,t,r)=>{"use strict";r.r(t),r.d(t,{useRestoreWallet:()=>c});var a=r(7620),s=r(2942),n=r(4111);async function l(){try{let e=new n.sV;return await (0,n.QO)(e)}catch(e){throw e}}var o=r(7153),i=r(5403);function c(){let{setWallet:e,setWalletStatus:t,mnemonic:r,password:n,networkType:c,walletName:h}=(0,o.v)(),[u,d]=(0,a.useState)(!1),[w,g]=(0,a.useState)(null),m=(0,s.useRouter)();return{restoreWallet:(0,a.useCallback)(async(a,s,o,u)=>{d(!0),g(null);try{let d=await l(),w=a||r,g=s||n,W=u||h;if(!w||!g||!W)throw Error("Mnemonic, password, and name are required to restore the wallet.");let x=await d.restoreWallet(w,g,o||c,W);e(x),t(i.k.WALLET_UNLOCKED),m.replace("/")}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";g("Failed to restore wallet: ".concat(e))}finally{d(!1)}},[r,n,c,h,e,t,m]),isRestoring:u,restorationError:w}}},5353:()=>{},5403:(e,t,r)=>{"use strict";r.d(t,{k:()=>a});var a=function(e){return e.NO_WALLET="NO_WALLET",e.WALLET_LOCKED="WALLET_LOCKED",e.WALLET_UNLOCKED="WALLET_UNLOCKED",e}({})},6140:()=>{},7153:(e,t,r)=>{"use strict";r.d(t,{v:()=>n});var a=r(7620),s=r(8317);function n(){let e=(0,a.useContext)(s.WalletContext);if(!e)throw Error("useWallet must be used within a WalletProvider");return e}},8317:(e,t,r)=>{"use strict";r.r(t),r.d(t,{WalletContext:()=>i,WalletProvider:()=>c});var a=r(4568),s=r(7620),n=r(2942),l=r(4111),o=r(5403);let i=(0,s.createContext)({wallet:null,setWallet:()=>{},walletStatus:o.k.NO_WALLET,setWalletStatus:()=>{},password:"",setPassword:()=>{},mnemonic:"",setMnemonic:()=>{},networkType:l.z1.Mainnet,setNetworkType:()=>{},walletName:"",setWalletName:()=>{}});function c(e){let{children:t}=e,[r,c]=(0,s.useState)(null),[h,u]=(0,s.useState)(o.k.NO_WALLET),[d,w]=(0,s.useState)(""),[g,m]=(0,s.useState)(""),[W,x]=(0,s.useState)(l.z1.Mainnet),[y,E]=(0,s.useState)(""),p=(0,n.useRouter)();return(0,s.useEffect)(()=>{let e=localStorage.getItem("walletStatus");if(e===o.k.WALLET_LOCKED){let e=localStorage.getItem("pactus_wallet_data");if(e)try{let t=JSON.parse(e);m(t.mnemonic),x(t.network),E(t.name),u(o.k.WALLET_LOCKED),"/unlock"!==window.location.pathname&&p.replace("/unlock")}catch(e){console.error("Failed to parse wallet data:",e),u(o.k.NO_WALLET),p.replace("/get-started")}else u(o.k.NO_WALLET),p.replace("/get-started")}else e===o.k.WALLET_UNLOCKED?(u(o.k.WALLET_UNLOCKED),"/"!==window.location.pathname&&p.replace("/")):(u(o.k.NO_WALLET),"/get-started"!==window.location.pathname&&p.replace("/get-started"))},[p]),(0,a.jsx)(i.Provider,{value:{wallet:r,setWallet:c,walletStatus:h,setWalletStatus:e=>{localStorage.setItem("walletStatus",e),u(e),e===o.k.NO_WALLET?(c(null),p.replace("/get-started")):e===o.k.WALLET_UNLOCKED&&"/"!==window.location.pathname&&p.replace("/")},password:d,setPassword:w,mnemonic:g,setMnemonic:m,networkType:W,setNetworkType:x,walletName:y,setWalletName:E},children:t})}}}]);